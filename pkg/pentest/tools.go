// Copyright 2025, Command Line Inc.
// SPDX-License-Identifier: Apache-2.0

package pentest

import (
	"github.com/wavetermdev/waveterm/pkg/aiclient"
)

// GetPentestTools возвращает список инструментов для AI
func GetPentestTools() []aiclient.Tool {
	return []aiclient.Tool{
		{
			Name:        "read_file",
			Description: "Чтение содержимого файла. Используй для анализа конфигов, скриптов, логов.",
			InputSchema: map[string]interface{}{
				"type": "object",
				"properties": map[string]interface{}{
					"path": map[string]interface{}{
						"type":        "string",
						"description": "Путь к файлу (абсолютный или относительный)",
					},
				},
				"required": []string{"path"},
			},
		},
		{
			Name:        "write_file",
			Description: "Создание или перезапись файла. Используй для сохранения эксплойтов, скриптов, отчётов.",
			InputSchema: map[string]interface{}{
				"type": "object",
				"properties": map[string]interface{}{
					"path": map[string]interface{}{
						"type":        "string",
						"description": "Путь к файлу",
					},
					"content": map[string]interface{}{
						"type":        "string",
						"description": "Содержимое файла",
					},
				},
				"required": []string{"path", "content"},
			},
		},
		{
			Name:        "edit_file",
			Description: "Редактирование файла (замена текста). Используй для модификации скриптов и конфигов.",
			InputSchema: map[string]interface{}{
				"type": "object",
				"properties": map[string]interface{}{
					"path": map[string]interface{}{
						"type":        "string",
						"description": "Путь к файлу",
					},
					"old_text": map[string]interface{}{
						"type":        "string",
						"description": "Текст для замены",
					},
					"new_text": map[string]interface{}{
						"type":        "string",
						"description": "Новый текст",
					},
				},
				"required": []string{"path", "old_text", "new_text"},
			},
		},
		{
			Name:        "execute_command",
			Description: "Выполнение bash команды. Используй для запуска утилит, скриптов, проверки системы.",
			InputSchema: map[string]interface{}{
				"type": "object",
				"properties": map[string]interface{}{
					"command": map[string]interface{}{
						"type":        "string",
						"description": "Bash команда для выполнения",
					},
				},
				"required": []string{"command"},
			},
		},
		{
			Name:        "scan_target",
			Description: "Сканирование цели для поиска открытых портов и сервисов. Используй когда нужно просканировать IP адрес или сеть.",
			InputSchema: map[string]interface{}{
				"type": "object",
				"properties": map[string]interface{}{
					"target": map[string]interface{}{
						"type":        "string",
						"description": "IP адрес или CIDR диапазон (например '192.168.1.100' или '192.168.1.0/24')",
					},
					"scan_type": map[string]interface{}{
						"type":        "string",
						"enum":        []string{"quick", "full", "stealth"},
						"description": "Тип сканирования: quick (топ 1000 портов), full (все порты + определение сервисов), stealth (SYN сканирование)",
					},
				},
				"required": []string{"target"},
			},
		},
		{
			Name:        "search_exploits",
			Description: "Поиск эксплойтов в базе Metasploit по ключевым словам, названию сервиса или CVE номеру.",
			InputSchema: map[string]interface{}{
				"type": "object",
				"properties": map[string]interface{}{
					"query": map[string]interface{}{
						"type":        "string",
						"description": "Поисковый запрос (например 'SMB', 'MS17-010', 'apache')",
					},
				},
				"required": []string{"query"},
			},
		},
		{
			Name:        "exploit_target",
			Description: "Эксплуатация уязвимости на цели используя указанный модуль эксплойта из Metasploit. Автоматически настраивает payload и опции.",
			InputSchema: map[string]interface{}{
				"type": "object",
				"properties": map[string]interface{}{
					"target": map[string]interface{}{
						"type":        "string",
						"description": "IP адрес цели",
					},
					"exploit_module": map[string]interface{}{
						"type":        "string",
						"description": "Путь к модулю эксплойта MSF (например 'exploit/windows/smb/ms17_010_eternalblue')",
					},
					"port": map[string]interface{}{
						"type":        "integer",
						"description": "Порт цели",
					},
					"lhost": map[string]interface{}{
						"type":        "string",
						"description": "Локальный IP для обратного подключения (опционально, определяется автоматически)",
					},
				},
				"required": []string{"target", "exploit_module"},
			},
		},
		{
			Name:        "list_sessions",
			Description: "Получить список всех активных meterpreter и shell сессий с деталями.",
			InputSchema: map[string]interface{}{
				"type":       "object",
				"properties": map[string]interface{}{},
			},
		},
		{
			Name:        "run_session_command",
			Description: "Выполнить команду в активной meterpreter или shell сессии.",
			InputSchema: map[string]interface{}{
				"type": "object",
				"properties": map[string]interface{}{
					"session_id": map[string]interface{}{
						"type":        "integer",
						"description": "ID сессии",
					},
					"command": map[string]interface{}{
						"type":        "string",
						"description": "Команда для выполнения (например 'sysinfo', 'ps', 'screenshot', 'shell')",
					},
				},
				"required": []string{"session_id", "command"},
			},
		},
		{
			Name:        "msf_rpc_call",
			Description: "Прямой вызов любого метода Metasploit RPC API. Используй для продвинутых операций, которые не покрыты другими инструментами.",
			InputSchema: map[string]interface{}{
				"type": "object",
				"properties": map[string]interface{}{
					"method": map[string]interface{}{
						"type":        "string",
						"description": "Название RPC метода (например 'module.execute', 'session.list', 'console.create')",
					},
					"params": map[string]interface{}{
						"type":        "array",
						"description": "Параметры метода в виде массива",
					},
				},
				"required": []string{"method"},
			},
		},
	}
}
